---
# Requires Ansible >= 1.9
- hosts: localhost
  tasks:
    - name: install packages
      apt:
        name: "{{ item }}"
        state: installed
        cache_valid_time: 3600
      loop:
        - python3
        - python3-pip

    - name: install python packages
      pip:
        name: pytest
        executable: pip3
  tags:
    - tester

- hosts: localhost
  roles:
  - mailtester-dnsmasq
  vars:
    mailtester_dnsmasq_ip: 172.17.0.2
    mailtester_dnsmasq_client_ip: 172.17.0.3
  tags: 
    - tester

- hosts: localhost
  tasks:

  - name: copy fixtures file
    copy: src=fixtures/mailserverdb.sql dest=/tmp

  - name: import fixtures
    postgresql_db:
      name: mailserver
      state: restore
      target: /tmp/mailserverdb.sql
    become: true
    become_user: postgres
  tags:
    - mailserver

